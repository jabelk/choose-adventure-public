# Data Model: Story Gallery

## New Entities

### SavedStory

Represents a completed story persisted to disk. Created from a StorySession when the story reaches an ending.

| Field | Type | Description |
|-------|------|-------------|
| story_id | string (UUID) | Unique identifier, same as the original Story.story_id |
| title | string | Story title generated by Claude |
| prompt | string | User's original adventure prompt |
| tier | string | Tier name ("kids", "nsfw") |
| length | string | Story length enum value ("short", "medium", "long") |
| target_depth | integer | Target number of chapters |
| created_at | datetime | When the story was started |
| completed_at | datetime | When the ending scene was reached |
| scenes | dict[string, SavedScene] | All scenes keyed by scene_id (full branching tree) |
| path_history | list[string] | Ordered scene IDs of the path taken |

### SavedScene

A scene within a saved story. Mirrors the Scene model but without mutable session state.

| Field | Type | Description |
|-------|------|-------------|
| scene_id | string (UUID) | Unique scene identifier |
| parent_scene_id | string or null | Scene this branched from |
| choice_taken_id | string or null | Choice ID that led to this scene |
| content | string | Narrative text |
| image_url | string or null | Path to image file (e.g., "/static/images/{scene_id}.png") or null if failed |
| image_prompt | string | Original image generation prompt |
| choices | list[SavedChoice] | Available choices at this scene |
| is_ending | boolean | Whether this is a terminal scene |
| depth | integer | Chapter number (0-indexed) |

### SavedChoice

A choice option preserved in the archive.

| Field | Type | Description |
|-------|------|-------------|
| choice_id | string (UUID) | Unique choice identifier |
| text | string | Choice description text |
| next_scene_id | string or null | Scene ID this choice leads to (if taken) |

## Persistence

- **Storage location**: `data/stories/{story_id}.json`
- **Format**: JSON (Pydantic model `.model_dump(mode="json")`)
- **One file per story**: Avoids write conflicts, easy to manage
- **Naming**: Files named by story_id UUID for uniqueness

## Relationships

```
SavedStory
├── scenes: dict[str, SavedScene]  (1:many, all generated scenes)
│   └── choices: list[SavedChoice]  (1:many per scene)
└── path_history: list[str]  (ordered references to scene_ids)
```

## Conversion

`StorySession` → `SavedStory`:
- Copy story metadata (story_id, title, prompt, tier, length, target_depth, created_at)
- Set completed_at to current time
- Convert each Scene → SavedScene (extract image.url → image_url, image.prompt → image_prompt)
- Copy path_history as-is
