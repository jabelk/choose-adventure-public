# Research: Picture Book Mode

## R1: Extra Image Prompt Derivation Strategy

**Decision**: Derive extra image prompts by appending variation instructions to the main image prompt.

**Rationale**: The main image prompt is already generated by the AI story service with scene-appropriate detail. Appending close-up/wide-shot instructions preserves visual consistency while creating meaningful variations. This avoids asking the AI to generate separate prompts (slower, more tokens, risk of inconsistency).

**Alternatives considered**:
- Ask AI to generate 3 separate image prompts per scene → Rejected: slower, more expensive, prompts may diverge visually
- Use a fixed set of variation prompts unrelated to scene → Rejected: loses scene context
- Post-process main image with image editing APIs → Rejected: not supported by current image models

## R2: Fast Model Selection

**Decision**: Use `gpt-image-1-mini` as the fast model. Fall back to the user's selected model if the mini model is not available (no OpenAI key configured).

**Rationale**: gpt-image-1-mini is the fastest image model currently available. It's already in the model registry. Falling back to the user's model ensures the feature still works even without the fast model configured.

**Alternatives considered**:
- Always use the same model for all images → Rejected: defeats the speed benefit for extra images
- Use a config setting for the fast model → Rejected: over-engineering for a personal project
- Hard-code a list of fast models with priority → Rejected: unnecessary complexity; one fast model is sufficient

## R3: Backward Compatibility for Gallery

**Decision**: Add `extra_image_urls` and `extra_image_prompts` as optional list fields (default empty) to SavedScene. Old stories without extra images will have empty lists and render normally.

**Rationale**: Pydantic models with default values handle missing fields gracefully when loading old JSON. No migration needed.

**Alternatives considered**:
- Migrate existing gallery JSON files → Rejected: unnecessary; defaults handle it
- Change `image_url` to `image_urls` list → Rejected: breaks existing code paths for main image

## R4: Polling Architecture

**Decision**: Extend the existing `GET /story/image/{scene_id}` endpoint to include `extra_images` in the response. Frontend polls the same endpoint and processes all image statuses.

**Rationale**: Single polling endpoint is simpler than multiple. The response payload is small (status + url for 3 images). Avoids race conditions from parallel polls to different endpoints.

**Alternatives considered**:
- Separate endpoints per extra image → Rejected: 3 parallel polls per scene is wasteful
- WebSocket for real-time updates → Rejected: massive over-engineering for this use case
- Server-sent events → Rejected: adds complexity for marginal benefit over 2-second polling
